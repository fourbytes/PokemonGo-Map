/*
 pogomap 28/07/2016 09:57 
*/
"use strict";function excludePokemon(a){$selectExclude.val($selectExclude.val().concat(a)).trigger("change")}function notifyAboutPokemon(a){$selectNotify.val($selectNotify.val().concat(a)).trigger("change")}function removePokemonMarker(a){mapData.pokemon[encounter_id].hidden=!0,mapData.pokemon[a].marker.setMap(null)}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:center_lat,lng:center_lng},zoom:16,fullscreenControl:!0,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,"nolabels_style","dark_style","style_light2","style_pgo","dark_style_nl","style_light2_nl","style_pgo_nl"]}});var a=new google.maps.StyledMapType(noLabelsStyle,{name:"No Labels"});map.mapTypes.set("nolabels_style",a);var b=new google.maps.StyledMapType(darkStyle,{name:"Dark"});map.mapTypes.set("dark_style",b);var c=new google.maps.StyledMapType(light2Style,{name:"Light2"});map.mapTypes.set("style_light2",c);var d=new google.maps.StyledMapType(pGoStyle,{name:"PokemonGo"});map.mapTypes.set("style_pgo",d);var e=new google.maps.StyledMapType(darkStyleNoLabels,{name:"Dark (No Labels)"});map.mapTypes.set("dark_style_nl",e);var f=new google.maps.StyledMapType(light2StyleNoLabels,{name:"Light2 (No Labels)"});map.mapTypes.set("style_light2_nl",f);var g=new google.maps.StyledMapType(pGoStyleNoLabels,{name:"PokemonGo (No Labels)"});map.mapTypes.set("style_pgo_nl",g),map.addListener("maptypeid_changed",function(a){Store.set("map_style",this.mapTypeId)}),map.setMapTypeId(Store.get("map_style")),google.maps.event.addListener(map,"idle",updateMap),marker=createSearchMarker(),addMyLocationButton(),initSidebar(),google.maps.event.addListenerOnce(map,"idle",function(){updateMap()}),google.maps.event.addListener(map,"zoom_changed",function(){redrawPokemon(mapData.pokemon),redrawPokemon(mapData.luredPokemon)})}function createSearchMarker(){marker=new google.maps.Marker({position:{lat:center_lat,lng:center_lng},map:map,animation:google.maps.Animation.DROP,draggable:!0});var a=null;return google.maps.event.addListener(marker,"dragstart",function(){a=marker.getPosition()}),google.maps.event.addListener(marker,"dragend",function(){var b=marker.getPosition();changeSearchLocation(b.lat(),b.lng()).done(function(){a=null,setupRadiusMarker()}).fail(function(){a&&marker.setPosition(a)})}),setupRadiusMarker(),marker}function initSidebar(){$("#gyms-switch").prop("checked",Store.get("showGyms")),$("#pokemon-switch").prop("checked",Store.get("showPokemon")),$("#pokestops-switch").prop("checked",Store.get("showPokestops")),$("#geoloc-switch").prop("checked",Store.get("geoLocate")),$("#radius-switch").prop("checked",Store.get("showRadius")),$("#sound-switch").prop("checked",Store.get("playSound"));var a=new google.maps.places.SearchBox(document.getElementById("next-location"));a.addListener("places_changed",function(){var b=a.getPlaces();if(0!=b.length){var c=b[0].geometry.location;changeLocation(c.lat(),c.lng())}});var b=$("#pokemon-icons");$.each(pokemonSprites,function(a,c){b.append($("<option></option>").attr("value",a).text(c.name))}),b.val(pokemonSprites[Store.get("pokemonIcons")]?Store.get("pokemonIcons"):"highres"),$("#pokemon-icon-size").val(Store.get("iconSizeModifier"))}function pad(a){return a<=99?("0"+a).slice(-2):a}function pokemonLabel(a,b,c,d,e,f){var g=new Date(b),h="\n        <div>\n            <b>"+a+"</b>\n            <span> - </span>\n            <small>\n                <a href='http://www.pokemon.com/us/pokedex/"+c+"' target='_blank' title='View in Pokedex'>#"+c+"</a>\n            </small>\n        </div>\n        <div>\n            Disappears at "+pad(g.getHours())+":"+pad(g.getMinutes())+":"+pad(g.getSeconds())+"\n            <span class='label-countdown' disappears-at='"+b+"'>(00m00s)</span>\n        </div>\n        <div>\n            Location: "+d.toFixed(6)+", "+e.toFixed(7)+"\n        </div>\n        <div>\n            <a href='javascript:excludePokemon("+f+")'>Exclude</a>&nbsp;&nbsp;\n            <a href='javascript:notifyAboutPokemon("+f+")'>Notify</a>&nbsp;&nbsp;\n            <a href='javascript:removePokemonMarker(\""+f+"\")'>Remove</a>&nbsp;&nbsp;\n            <a href='https://www.google.com/maps/dir/Current+Location/"+d+","+e+"'\n                    target='_blank' title='View in Maps'>Get directions</a>\n        </div>";return h}function gymLabel(a,b,c,d,e){var f,g=["0, 0, 0, .4","74, 138, 202, .6","240, 68, 58, .6","254, 217, 40, .6"];if(0==b)f="<div><center>\n            <div>\n                <b style='color:rgba("+g[b]+")'>"+a+"</b><br>\n                <img height='70px' style='padding: 5px;' src='static/forts/"+a+"_large.png'>\n            </div>\n            <div>\n                Location: "+d.toFixed(6)+", "+e.toFixed(7)+"\n            </div>\n            <div>\n                <a href='https://www.google.com/maps/dir/Current+Location/"+d+","+e+"'\n                        target='_blank' title='View in Maps'>Get directions</a>\n            </div>\n            </center></div>";else{for(var h=[2e3,4e3,8e3,12e3,16e3,2e4,3e4,4e4,5e4],i=1;c>=h[i-1];)i++;f="\n            <div><center>\n            <div style='padding-bottom: 2px'>Gym owned by:</div>\n            <div>\n                <b style='color:rgba("+g[b]+")'>Team "+a+"</b><br>\n                <img height='70px' style='padding: 5px;' src='static/forts/"+a+"_large.png'>\n            </div>\n            <div>Level: "+i+" | Prestige: "+c+"</div>\n            <div>\n                Location: "+d.toFixed(6)+", "+e.toFixed(7)+"\n            </div>\n            <div>\n                <a href='https://www.google.com/maps/dir/Current+Location/"+d+","+e+"'\n                        target='_blank' title='View in Maps'>Get directions</a>\n            </div>\n            </center></div>"}return f}function pokestopLabel(a,b,c,d,e){var f;if(a){var g=idToPokemon[c],h=new Date(b),i=new Date,j=i.getTime()-h.getTime(),k=new Date(i.getTime()+j),l=k.getTime();f="\n            <div>\n                <b>Lured Pokéstop</b>\n            </div>\n            <div>\n                Lured Pokémon: "+g+"\n                <span> - </span>\n                <small>\n                    <a href='http://www.pokemon.com/us/pokedex/"+c+"' target='_blank' title='View in Pokedex'>#"+c+"</a>\n                </small>\n            </div>\n            <div>\n                Lure expires at "+pad(k.getHours())+":"+pad(k.getMinutes())+":"+pad(k.getSeconds())+"\n                <span class='label-countdown' disappears-at='"+l+"'>(00m00s)</span></div>\n            <div>\n            <div>\n                Location: "+d.toFixed(6)+", "+e.toFixed(7)+"\n            </div>\n            <div>\n                <a href='https://www.google.com/maps/dir/Current+Location/"+d+","+e+"'\n                        target='_blank' title='View in Maps'>Get directions</a>\n            </div>"}else f="\n            <div>\n                <b>Pokéstop</b>\n            </div>\n            <div>\n                Location: "+d.toFixed(6)+", "+e.toFixed(7)+"\n            </div>\n            <div>\n                <a href='https://www.google.com/maps/dir/Current+Location/"+d+","+e+"'\n                        target='_blank' title='View in Maps'>Get directions</a>\n            </div>";return f}function getGoogleSprite(a,b,c){c=Math.max(c,3);var d=c/b.icon_height,e=new google.maps.Size(d*b.icon_width-1,d*b.icon_height-1),f=new google.maps.Point(a%b.columns*b.icon_width*d+.5,Math.floor(a/b.columns)*b.icon_height*d+.5),g=new google.maps.Size(d*b.sprite_width,d*b.sprite_height),h=new google.maps.Point(d*b.icon_width/2,d*b.icon_height/2);return{url:b.filename,size:e,scaledSize:g,origin:f,anchor:h}}function setupPokemonMarker(a,b){var c=2+(map.getZoom()-3)*(map.getZoom()-3)*.2+Store.get("iconSizeModifier"),d=a.pokemon_id-1,e=pokemonSprites[Store.get("pokemonIcons")]||pokemonSprites.highres,f=getGoogleSprite(d,e,c),g=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},zIndex:9999,optimized:!1,map:map,icon:f});return g.infoWindow=new google.maps.InfoWindow({content:pokemonLabel(a.pokemon_name,a.disappear_time,a.pokemon_id,a.latitude,a.longitude,a.id),disableAutoPan:!0}),notifiedPokemon.indexOf(a.pokemon_id)>-1&&(b||(Store.get("playSound")&&audio.play(),sendNotification("A wild "+a.pokemon_name+" appeared!","Click to load map","static/icons/"+a.pokemon_id+".png",a.latitude,a.longitude)),g.setAnimation(google.maps.Animation.BOUNCE)),addListeners(g),g}function setupGymMarker(a){var b=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:map,icon:"static/forts/"+gymTypes[a.team_id]+".png"});return b.infoWindow=new google.maps.InfoWindow({content:gymLabel(gymTypes[a.team_id],a.team_id,a.gym_points,a.latitude,a.longitude),disableAutoPan:!0}),addListeners(b),b}function setupPokestopMarker(a){var b=a.lure_expiration?"PstopLured":"Pstop",c=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:map,zIndex:2,optimized:!1,icon:"static/forts/"+b+".png"});return c.infoWindow=new google.maps.InfoWindow({content:pokestopLabel(!!a.lure_expiration,a.last_modified,a.active_pokemon_id,a.latitude+.003,a.longitude+.003),disableAutoPan:!0}),addListeners(c),c}function setupRadiusMarker(){if(null!=rmarker&&rmarker.setMap(null),0!=Store.get("showRadius")&&0!=mapData.radius)return rmarker=new google.maps.Circle({map:map,center:marker.position,radius:mapData.radius,fillColor:"rgba(70, 70, 250, 0.1)",strokeWeight:.4})}function clearSelection(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}function addListeners(a){return a.addListener("click",function(){a.infoWindow.open(map,a),clearSelection(),updateLabelDiffTime(),a.persist=!0}),google.maps.event.addListener(a.infoWindow,"closeclick",function(){a.persist=null}),a.addListener("mouseover",function(){a.infoWindow.open(map,a),clearSelection(),updateLabelDiffTime()}),a.addListener("mouseout",function(){a.persist||a.infoWindow.close()}),a}function clearStaleMarkers(){$.each(mapData.pokemon,function(a,b){(mapData.pokemon[a].disappear_time<(new Date).getTime()||excludedPokemon.indexOf(mapData.pokemon[a].pokemon_id)>=0)&&(mapData.pokemon[a].marker.setMap(null),delete mapData.pokemon[a])}),$.each(mapData.luredPokemon,function(a,b){(mapData.luredPokemon[a].lure_expiration<(new Date).getTime()||excludedPokemon.indexOf(mapData.luredPokemon[a].pokemon_id)>=0)&&(mapData.luredPokemon[a].marker.setMap(null),delete mapData.luredPokemon[a])})}function showInBoundsMarkers(a){$.each(a,function(b,c){var d=a[b].marker,e=!1;a[b].hidden||("function"==typeof d.getPosition?map.getBounds().contains(d.getPosition())&&(e=!0):"function"==typeof d.getCenter&&map.getBounds().contains(d.getCenter())&&(e=!0)),e&&!a[b].marker.getMap()?a[b].marker.setMap(map):!e&&a[b].marker.getMap()&&a[b].marker.setMap(null)})}function loadRawData(){var a=Store.get("showPokemon"),b=Store.get("showGyms"),c=Store.get("showPokestops")||Store.get("showPokemon"),d=map.getBounds(),e=d.getSouthWest(),f=d.getNorthEast(),g=e.lat()-1,h=e.lng()-1,i=f.lat()+1,j=f.lng()+1;return $.ajax({url:"raw_data",type:"GET",data:{pokemon:a,pokestops:c,gyms:b,swLat:g,swLng:h,neLat:i,neLng:j},dataType:"json",beforeSend:function(){return!rawDataIsLoading&&void(rawDataIsLoading=!0)},complete:function(){rawDataIsLoading=!1}})}function processPokemon(a,b){return!!Store.get("showPokemon")&&void(!(b.id in mapData.pokemon)&&excludedPokemon.indexOf(b.pokemon_id)<0&&(b.marker&&b.marker.setMap(null),b.marker=setupPokemonMarker(b),mapData.pokemon[b.id]=b))}function processPokestops(a,b){if(!Store.get("showPokestops"))return!1;if(null==mapData.pokestops[b.id])b.marker&&b.marker.setMap(null),b.marker=setupPokestopMarker(b),mapData.pokestops[b.id]=b;else{var c=mapData.pokestops[b.id];!!b.lure_expiration==!!c.lure_expiration&&b.active_pokemon_id==c.active_pokemon_id||(it2m.marker.setMap(null),b.marker=setupPokestopMarker(b),mapData.pokestops[b.id]=b)}}function processLuredPokemon(a,b){if(!Store.get("showPokemon"))return!1;var c={pokestop_id:b.pokestop_id,lure_expiration:b.lure_expiration,pokemon_id:b.active_pokemon_id,latitude:b.latitude+5e-5,longitude:b.longitude+5e-5,pokemon_name:idToPokemon[b.active_pokemon_id],disappear_time:b.lure_expiration};null!=c.pokemon_id&&(null==mapData.luredPokemon[c.pokestop_id]&&c.lure_expiration&&!c.hidden&&(c.marker=setupPokemonMarker(c),mapData.luredPokemon[c.pokestop_id]=c),null!=mapData.luredPokemon[b.pokestop_id]&&c.lure_expiration&&c.active_pokemon_id!=mapData.luredPokemon[c.pokestop_id].active_pokemon_id&&(mapData.luredPokemon[c.pokestop_id].marker.setMap(null),c.hidden||(c.marker=setupPokemonMarker(c),mapData.luredPokemon[c.pokestop_id]=c)))}function processGyms(a,b){return!!Store.get("showGyms")&&void(b.id in mapData.gyms?mapData.gyms[b.id].team_id!=b.team_id?(mapData.gyms[b.id].marker.setMap(null),mapData.gyms[b.id].marker=setupGymMarker(b)):mapData.gyms[b.id].marker.infoWindow=new google.maps.InfoWindow({content:gymLabel(gymTypes[b.team_id],b.team_id,b.gym_points,b.latitude,b.longitude),disableAutoPan:!0}):(b.marker&&b.marker.setMap(null),b.marker=setupGymMarker(b),mapData.gyms[b.id]=b))}function updateMap(){loadRawData().done(function(a){mapData.radius=a.searchRadius,setupRadiusMarker(),$.each(a.pokemon,processPokemon),$.each(a.pokestops,processPokestops),$.each(a.pokestops,processLuredPokemon),$.each(a.gyms,processGyms),showInBoundsMarkers(mapData.pokemon),showInBoundsMarkers(mapData.luredPokemon),showInBoundsMarkers(mapData.gyms),showInBoundsMarkers(mapData.pokestops),clearStaleMarkers()})}function redrawPokemon(a){var b=!0;$.each(a,function(c,d){var e=a[c];if(!e.hidden){var f=setupPokemonMarker(e,b);e.marker.setMap(null),a[c].marker=f}})}function getPointDistance(a,b){return google.maps.geometry.spherical.computeDistanceBetween(a,b)}function sendNotification(a,b,c,d,e){if(!("Notification"in window))return!1;if("granted"!==Notification.permission)Notification.requestPermission();else{var f=new Notification(a,{icon:c,body:b,sound:"sounds/ding.mp3"});f.onclick=function(){window.focus(),f.close(),centerMap(d,e,20)}}}function myLocationButton(a,b){var c=document.createElement("div"),d=document.createElement("button");d.style.backgroundColor="#fff",d.style.border="none",d.style.outline="none",d.style.width="28px",d.style.height="28px",d.style.borderRadius="2px",d.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",d.style.cursor="pointer",d.style.marginRight="10px",d.style.padding="0px",d.title="Your Location",c.appendChild(d);var e=document.createElement("div");e.style.margin="5px",e.style.width="18px",e.style.height="18px",e.style.backgroundImage="url(static/mylocation-sprite-1x.png)",e.style.backgroundSize="180px 18px",e.style.backgroundPosition="0px 0px",e.style.backgroundRepeat="no-repeat",e.id="current-location",d.appendChild(e),d.addEventListener("click",function(){var b=document.getElementById("current-location"),c="0",d=setInterval(function(){c="-18"==c?"0":"-18",b.style.backgroundPosition=c+"px 0"},500);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(c){var e=new google.maps.LatLng(c.coords.latitude,c.coords.longitude);locationMarker.setVisible(!0),locationMarker.setOptions({opacity:1}),locationMarker.setPosition(e),a.setCenter(e),clearInterval(d),b.style.backgroundPosition="-144px 0px"}):(clearInterval(d),b.style.backgroundPosition="0px 0px")}),c.index=1,a.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(c)}function addMyLocationButton(){locationMarker=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:{lat:center_lat,lng:center_lng},icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:1,fillColor:"#1c8af6",scale:6,strokeColor:"#1c8af6",strokeWeight:8,strokeOpacity:.3}}),locationMarker.setVisible(!1),myLocationButton(map,locationMarker),google.maps.event.addListener(map,"dragend",function(){var a=document.getElementById("current-location");a.style.backgroundPosition="0px 0px",locationMarker.setOptions({opacity:.5})})}function changeLocation(a,b){var c=new google.maps.LatLng(a,b);changeSearchLocation(a,b).done(function(){map.setCenter(c),marker.setPosition(c)})}function changeSearchLocation(a,b){return $.post("next_loc?lat="+a+"&lon="+b,{})}function centerMap(a,b,c){var d=new google.maps.LatLng(a,b);map.setCenter(d),c&&map.setZoom(c)}function updateHeatmapOverlay(){var a=Store.get("rememberHeatmapPokemon");0!=a&&($selectHeatmap=$("#heatmap-pokemon"),$.ajax({url:"points",type:"GET",data:{pokemon_id:a},dataType:"json",beforeSend:function(){$selectHeatmap.attr("disabled",!0)},success:function(a){var b=a.points.map(function(a){return new google.maps.LatLng(a[0],a[1])});currentHeatmap&&currentHeatmap.setMap(null),currentHeatmap=new google.maps.visualization.HeatmapLayer({data:b,radius:20,opacity:.75}),currentHeatmap.setMap(map),$selectHeatmap.attr("disabled",!1)}}))}!function(){var a=function(a,b,c){var d,e=b.split(" ");for(d in e)a.addEventListener(e[d],c)};!function(){function a(a){this.el=a;for(var b=a.className.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c++)d.call(this,b[c])}function b(a,b,c){Object.defineProperty?Object.defineProperty(a,b,{get:c}):a.__defineGetter__(b,c)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var c=Array.prototype,d=c.push,e=c.splice,f=c.join;a.prototype={add:function(a){this.contains(a)||(d.call(this,a),this.el.className=this.toString())},contains:function(a){return-1!=this.el.className.indexOf(a)},item:function(a){return this[a]||null},remove:function(a){if(this.contains(a)){for(var b=0;b<this.length&&this[b]!=a;b++);e.call(this,b,1),this.el.className=this.toString()}},toString:function(){return f.call(this," ")},toggle:function(a){return this.contains(a)?this.remove(a):this.add(a),this.contains(a)}},window.DOMTokenList=a,b(Element.prototype,"classList",function(){return new a(this)})}}();var b=document.querySelector("body");skel.breakpoints({xlarge:"(max-width: 1680px)",large:"(max-width: 1280px)",medium:"(max-width: 980px)",small:"(max-width: 736px)",xsmall:"(max-width: 480px)"}),b.classList.add("is-loading"),window.addEventListener("load",function(){b.classList.remove("is-loading")});var c,d=document.querySelector("#nav"),e=document.querySelector('a[href="#nav"]');a(d,"click touchend",function(a){a.stopPropagation()}),a(b,"click touchend",function(a){a.target.matches('a[href="#nav"]')||d.classList.remove("visible")}),e.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),d.classList.toggle("visible")}),c=document.createElement("a"),c.href="#",c.className="close",c.tabIndex=0,d.appendChild(c),window.addEventListener("keydown",function(a){27==a.keyCode&&d.classList.remove("visible")}),c.addEventListener("click",function(a){a.preventDefault(),a.stopPropagation(),d.classList.remove("visible")})}();var $selectExclude,$selectNotify,$selectHeatmap,language=""==document.documentElement.lang?"en":document.documentElement.lang,idToPokemon={},excludedPokemon=[],notifiedPokemon=[],map,currentHeatmap,rawDataIsLoading=!1,locationMarker,marker,rmarker,noLabelsStyle=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]}],light2Style=[{elementType:"geometry",stylers:[{hue:"#ff4400"},{saturation:-68},{lightness:-4},{gamma:.72}]},{featureType:"road",elementType:"labels.icon"},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{hue:"#0077ff"},{gamma:3.1}]},{featureType:"water",stylers:[{hue:"#00ccff"},{gamma:.44},{saturation:-33}]},{featureType:"poi.park",stylers:[{hue:"#44ff00"},{saturation:-23}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{hue:"#007fff"},{gamma:.77},{saturation:65},{lightness:99}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{gamma:.11},{weight:5.6},{saturation:99},{hue:"#0091ff"},{lightness:-86}]},{featureType:"transit.line",elementType:"geometry",stylers:[{lightness:-48},{hue:"#ff5e00"},{gamma:1.2},{saturation:-23}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{saturation:-64},{hue:"#ff9100"},{lightness:16},{gamma:.47},{weight:2.7}]}],darkStyle=[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#b39964"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#181818"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{lightness:17},{color:"#525252"}]}],pGoStyle=[{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#a1f199"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{color:"#e4dfd9"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#84b09e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#fafeb8"},{weight:"1.25"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#5ddad6"}]}],light2StyleNoLabels=[{elementType:"geometry",stylers:[{hue:"#ff4400"},{saturation:-68},{lightness:-4},{gamma:.72}]},{featureType:"road",elementType:"labels.icon"},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{hue:"#0077ff"},{gamma:3.1}]},{featureType:"water",stylers:[{hue:"#00ccff"},{gamma:.44},{saturation:-33}]},{featureType:"poi.park",stylers:[{hue:"#44ff00"},{saturation:-23}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{hue:"#007fff"},{gamma:.77},{saturation:65},{lightness:99}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{gamma:.11},{weight:5.6},{saturation:99},{hue:"#0091ff"},{lightness:-86}]},{featureType:"transit.line",elementType:"geometry",stylers:[{lightness:-48},{hue:"#ff5e00"},{gamma:1.2},{saturation:-23}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{saturation:-64},{hue:"#ff9100"},{lightness:16},{gamma:.47},{weight:2.7}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]}],darkStyleNoLabels=[{featureType:"all",elementType:"labels.text.fill",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#181818"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{lightness:17},{color:"#525252"}]}],pGoStyleNoLabels=[{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#a1f199"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{color:"#e4dfd9"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#84b09e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#fafeb8"},{weight:"1.25"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#5ddad6"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{visibility:"off"}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]}],selectedStyle="light",mapData={pokemon:{},gyms:{},pokestops:{},luredPokemon:{},radius:0},gymTypes=["Uncontested","Mystic","Valor","Instinct"],audio=new Audio("static/sounds/ding.mp3"),pokemonSprites={normal:{columns:12,icon_width:30,icon_height:30,sprite_width:360,sprite_height:390,filename:"static/icons-sprite.png",name:"Normal"},highres:{columns:7,icon_width:65,icon_height:65,sprite_width:455,sprite_height:1430,filename:"static/icons-large-sprite.png",name:"High-Res"}},StoreTypes={Boolean:{parse:function(a){switch(a.toLowerCase()){case"1":case"true":case"yes":return!0;default:return!1}},stringify:function(a){return a?"true":"false"}},JSON:{parse:function(a){return JSON.parse(a)},stringify:function(a){return JSON.stringify(a)}},String:{parse:function(a){return a},stringify:function(a){return a}},Number:{parse:function(a){return parseInt(a,10)},stringify:function(a){return a.toString()}}},StoreOptions={map_style:{default:"roadmap",type:StoreTypes.String},rememberSelectExclude:{default:[],type:StoreTypes.JSON},rememberSelectNotift:{default:[],type:StoreTypes.JSON},rememberHeatmapPokemon:{default:0,type:StoreTypes.Number},showGyms:{default:!1,type:StoreTypes.Boolean},showPokemon:{default:!0,type:StoreTypes.Boolean},showLuredPokemon:{default:!0,type:StoreTypes.Boolean},showPokestops:{default:!0,type:StoreTypes.Boolean},showRadius:{default:!0,type:StoreTypes.Boolean},playSound:{default:!1,type:StoreTypes.Boolean},geoLocate:{default:!1,type:StoreTypes.Boolean},playSound:{default:!1,type:StoreTypes.Boolean},pokemonIcons:{default:"highres",type:StoreTypes.String},iconSizeModifier:{default:0,type:StoreTypes.Number}},Store={getOption:function(a){var b=StoreOptions[a];if(!b)throw"Store key was not defined "+a;return b},get:function(a){var b=this.getOption(a),c=b.type,d=localStorage[a];if(null===d||void 0===d)return b.default;var e=c.parse(d);return e},set:function(a,b){var c=this.getOption(a),d=c.type||StoreTypes.String,e=d.stringify(b);localStorage[a]=e},reset:function(a){localStorage.removeItem(a)}},updateLabelDiffTime=function(){$(".label-countdown").each(function(a,b){var c,d=new Date(parseInt(b.getAttribute("disappears-at"))),e=new Date,f=Math.abs(d-e),g=Math.floor(f/36e5),h=Math.floor((f-36e5*g)/6e4),i=Math.floor((f-36e5*g-6e4*h)/1e3);d<e?c="(expired)":(c="(",g>0&&(c=g+"h"),c+=("0"+h).slice(-2)+"m",c+=("0"+i).slice(-2)+"s",c+=")"),$(b).text(c)})};$(function(){return Notification?void("granted"!==Notification.permission&&Notification.requestPermission()):void console.log("could not load notifications")}),$(function(){function a(a){if(!a.id)return a.text;var b=$('<span><i class="pokemon-sprite n'+a.element.value.toString()+'"></i> '+a.text+"</span>");return b}function b(a,b,c){return function(){Store.set(c,this.checked),this.checked?updateMap():($.each(a[b],function(c,d){a[b][c].marker.setMap(null)}),a[b]={})}}$selectExclude=$("#exclude-pokemon"),$selectNotify=$("#notify-pokemon"),$selectHeatmap=$("#heatmap-pokemon");var c=151;$.getJSON("static/locales/pokemon."+language+".json").done(function(b){var d=[];$.each(b,function(a,b){return!(a>c)&&(d.push({id:a,text:b+" - #"+a}),void(idToPokemon[a]=b))}),$selectExclude.select2({placeholder:"Select Pokémon",data:d,templateResult:a}),$selectNotify.select2({placeholder:"Select Pokémon",data:d,templateResult:a});var e=d;e.unshift({id:0,text:"None"}),$selectHeatmap.select2({placeholder:"Select Pokémon",data:e,templateResult:a}),$selectExclude.on("change",function(a){excludedPokemon=$(this).val().map(Number),Store.set("rememberSelectExclude",excludedPokemon),clearStaleMarkers()}),$selectNotify.on("change",function(a){notifiedPokemon=$(this).val().map(Number),Store.set("rememberSelectNotift",notifiedPokemon)}),$selectHeatmap.on("change",function(a){Store.set("rememberHeatmapPokemon",Number($(this).val())),updateHeatmapOverlay()}),$selectExclude.val(Store.get("rememberSelectExclude")).trigger("change"),$selectNotify.val(Store.get("rememberSelectNotift")).trigger("change"),$selectHeatmap.val(Store.get("rememberHeatmapPokemon")).trigger("change")}),window.setInterval(updateLabelDiffTime,1e3),window.setInterval(updateMap,5e3),window.setInterval(function(){navigator.geolocation&&Store.get("geoLocate")&&navigator.geolocation.getCurrentPosition(function(a){var b=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),c=a.coords.latitude,d=a.coords.longitude;getPointDistance(marker.getPosition(),new google.maps.LatLng(c,d))>40&&$.post(b+"/next_loc?lat="+c+"&lon="+d).done(function(){var a=new google.maps.LatLng(c,d);map.panTo(a),marker.setPosition(a)})})},1e3),$("#gyms-switch").change(b(mapData,"gyms","showGyms")),$("#pokemon-switch").change(b(mapData,"pokemon","showPokemon")),$("#pokestops-switch").change(b(mapData,"pokestops","showPokestops")),$("#radius-switch").change(function(){Store.set("showRadius",this.checked),setupRadiusMarker()}),$("#sound-switch").change(function(){Store.set("playSound",this.checked)}),$("#pokemon-icons").change(function(){Store.set("pokemonIcons",this.value),redrawPokemon(mapData.pokemon),redrawPokemon(mapData.luredPokemon)}),$("#pokemon-icon-size").change(function(){Store.set("iconSizeModifier",this.value),redrawPokemon(mapData.pokemon),redrawPokemon(mapData.luredPokemon)}),$("#geoloc-switch").change(function(){navigator.geolocation?Store.set("geoLocate",this.checked):this.checked=!1})});